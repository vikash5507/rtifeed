$(window).load(function(){
  $('#follow_state_modal').modal('show');
});

$(document).ready(function() {
	$('.welcome_table tr').click(function(event) {
  	if (event.target.type !== 'checkbox') {
  		$(':checkbox', this).trigger('click');
		}
	});
});

function save_user_preference(){
	var states = [];
	var users = [];
	$('.state_check_box').each(function(){
		if($(this).prop('checked')){
			states.push($(this).val());
		}
	});
	$('.user_check_box').each(function(){
		if($(this).prop('checked')){
			users.push($(this).val());
		}
	});
	var user_preference_data = {
		states : JSON.stringify(states),
		users : JSON.stringify(users)
	}

	$.ajax({
		url : '/save_user_preference',
		data : user_preference_data,
		type : 'GET',
		beforeSend : function(){
			swal({   
				title: "Please Wait..",
				text: "We are generating your personalized news feed.",
				showConfirmButton: false 
			});
		},
		success : function(data){
			loading = false;
			no_activity = false;
			$('#feedcontainer').html("");
			make_feed_for_url('/get_feed');
			swal('All set!', 'Thank you for choosing your preferences', 'success');
			tour.init(true);
			tour.start(true);
		},
		error : function(err){
			console.log(err);
		}
	});
}

$('#save_user_data').on('click', function(){
	save_user_preference();
});

var tour = new Tour({
  steps: [
  {
    element: "#tour_news_feed",
    title: "News Feed",
    content: "This is your autogenerated feed of all"+
    " RTI related activities based on your set preferences."+
    " Follow relevant topics/departments/users to have a"+
    " personalized experince."
  },
  {
    element: "#tour_rti_query",
    title: "Share an RTI which you have filed",
    content: "If you have filed an RTI in any concerned" + " state/central department, you may share it with the community. You may share the RTI even if you haven't received a response for it."
  },
  {
    element: "#tour_propose_query",
    title: "Propose an RTI",
    content: "It is alright if are not an activist and have never filed an RTI."+
    " Any relevant questions in mind? Propose an RTI and share it with the community." + 
    " They will suggest changes and file it for you, if they find the query appropriate."
  },
  {
    element: "#navbar-search-input",
    title: "Search",
    content: "Search across users, RTIs, Departments, States and Topics!",
    placement : 'bottom',
  },
  {
    element: "#tour_profile",
    title: "Profile",
    content: "Visit your profile to see your activity or change your account settings." + 
	"You may search for other people and follow them to be updated about their activity",
	placement : 'left',
  },
  {
    element: "#tour_message",
    title: "Messaging",
    content: "If you have any RTI related questions in mind or need clarity about something," + 
	"use RTIFeed messaging to contact the people you are seeking help from.",
	placement : 'left',
  },
  {
    element: "#tour_feedback",
    title: "Feedback",
    content: "We are in Beta. We would love to hear from you. Do let us know what you think about RTIFeed.",
	placement : 'top'
  },

]});

